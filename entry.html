<html>

<head>
 <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
 <meta content="utf-8" http-equiv="encoding">

 <script type="text/javascript" src="http://maps.google.com/maps/api/js"></script>
 <style type="text/css">
   html { height: 100% }
   body { height: 100%; margin: 0px; padding: 0px }
   #map_canvas { height: 100% }
 </style>

</head>

<body>

  <div id="map_canvas" style="width:100%; height:75%"></div>

  <!--
    //date selector
    //comment selector
    //display currently rendered data
   --!>

  <center>
  <p><button type="button">Submit</button> <button type="button" onclick="clearMap()">Clear</button></p>
  </center>

  <script>

    var options = { mapTypeId: google.maps.MapTypeId.ROADMAP,
      center: new google.maps.LatLng(40.7201813,-74.078644),
      zoom: 14,
    };
    var directionsService = new google.maps.DirectionsService();
    var map = new google.maps.Map(document.getElementById("map_canvas"), options);

    var markers = [ ];
    var routes = [ ];

    var start = null;

    google.maps.event.addListener(map, 'click', function(event) {
      var request = null; 
      
      var origin = event.latLng; 
      if(start != null) {
        origin = start;
      } else {
        start = event.latLng;
      }

      var request = {
          origin: origin,
          destination: event.latLng,
          travelMode: google.maps.DirectionsTravelMode.WALKING
      };

      directionsService.route(request, function(response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
          var marker = new google.maps.Marker({
             position: response.routes[0].legs[0].end_location, 
             map: map,
             preserveViewport: true
          });

          var res = { };
          res['marker'] = marker;
          res['renderer'] = null;
          res['route'] = null;

          if(request['origin'] != request['destination']) {
            var renderer = new google.maps.DirectionsRenderer({ suppressMarkers: true, preserveViewport: true });
            renderer.setMap(map);
            renderer.setDirections(response);

            res['renderer'] = renderer;
            res['route'] = response;
          }

          routes.push(res);
        }
      });
    });

    function clearMap() {
      for(var i = 0; i < routes.length; i++) {
        routes[i]['marker'].setMap(null);
        if(routes[i]['renderer'] != null)
          routes[i]['renderer'].setMap(null);
      }
      routes = [ ];
      start = null;
    }

  </script>

</body>

</html>
